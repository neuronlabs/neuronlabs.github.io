<!DOCTYPE html>

<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">

  
    <title>Repositories - neuronlabs.github.io</title>

    
  

  <link rel="shortcut icon" href="http://localhost:4000/favicon.ico" type="image/x-icon">

  <link rel="stylesheet" href="http://localhost:4000/assets/css/just-the-docs.css">

  

  
  <script type="text/javascript" src="http://localhost:4000/assets/js/just-the-docs.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Repositories | neuronlabs.github.io</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Repositories" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Neuronlabs Pages repository" />
<meta property="og:description" content="Neuronlabs Pages repository" />
<link rel="canonical" href="http://localhost:4000/neuron-core/repositories.html" />
<meta property="og:url" content="http://localhost:4000/neuron-core/repositories.html" />
<meta property="og:site_name" content="neuronlabs.github.io" />
<script type="application/ld+json">
{"@type":"WebPage","headline":"Repositories","url":"http://localhost:4000/neuron-core/repositories.html","description":"Neuronlabs Pages repository","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>

<body>

  <div class="page-wrap">
    <div class="side-bar">
      <a href="http://localhost:4000" class="site-title fs-6 lh-tight">neuronlabs.github.io</a>
      <span class="fs-3"><button class="js-main-nav-trigger navigation-list-toggle btn btn-outline" type="button" data-text-toggle="Hide">Menu</button></span>
      <div class="navigation main-nav js-main-nav">
        <nav role="navigation" aria-label="Main navigation">
  <ul class="navigation-list">
    
    
      
        
      
    
      
        
      
    
      
        
          <li class="navigation-list-item">
            
            <a href="http://localhost:4000/" class="navigation-list-link">Neuron</a>
            
          </li>
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
          <li class="navigation-list-item active">
            
            <a href="http://localhost:4000/neuron-core" class="navigation-list-link">Core ORM</a>
            
              
              <ul class="navigation-list-child-list ">
                
                  
                    <li class="navigation-list-item ">
                      
                      <a href="http://localhost:4000/neuron-core/controller.html" class="navigation-list-link">Controller</a>
                      
                    </li>
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                    <li class="navigation-list-item  active">
                      
                      <a href="http://localhost:4000/neuron-core/repositories.html" class="navigation-list-link active">Repositories</a>
                      
                    </li>
                  
                
                  
                
                  
                    <li class="navigation-list-item ">
                      
                      <a href="http://localhost:4000/neuron-core/models" class="navigation-list-link">Models</a>
                      
                        
                        <ul class="navigation-list-child-list">
                          
                            
                          
                            
                          
                            
                          
                            
                          
                            
                              <li class="navigation-list-item ">
                                <a href="http://localhost:4000/neuron-core/models/structure.html" class="navigation-list-link">Structure</a>
                              </li>
                            
                          
                            
                          
                            
                              <li class="navigation-list-item ">
                                <a href="http://localhost:4000/neuron-core/models/field.html" class="navigation-list-link">Fields</a>
                              </li>
                            
                          
                            
                          
                            
                          
                            
                          
                            
                          
                            
                          
                            
                          
                            
                          
                            
                              <li class="navigation-list-item ">
                                <a href="http://localhost:4000/neuron-core/models/relationship.html" class="navigation-list-link">Relationships</a>
                              </li>
                            
                          
                            
                              <li class="navigation-list-item ">
                                <a href="http://localhost:4000/neuron-core/models/config.html" class="navigation-list-link">Config</a>
                              </li>
                            
                          
                            
                          
                            
                          
                            
                          
                            
                          
                            
                          
                            
                          
                            
                          
                            
                          
                            
                          
                            
                          
                            
                          
                            
                          
                            
                          
                        </ul>
                      
                    </li>
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                    <li class="navigation-list-item ">
                      
                      <a href="http://localhost:4000/neuron-core/query/" class="navigation-list-link">Query</a>
                      
                        
                        <ul class="navigation-list-child-list">
                          
                            
                          
                            
                          
                            
                          
                            
                              <li class="navigation-list-item ">
                                <a href="http://localhost:4000/neuron-core/query/scope.html" class="navigation-list-link">Scope</a>
                              </li>
                            
                          
                            
                          
                            
                          
                            
                          
                            
                          
                            
                              <li class="navigation-list-item ">
                                <a href="http://localhost:4000/neuron-core/query/insert.html" class="navigation-list-link">Insert</a>
                              </li>
                            
                          
                            
                          
                            
                              <li class="navigation-list-item ">
                                <a href="http://localhost:4000/neuron-core/query/get.html" class="navigation-list-link">Get</a>
                              </li>
                            
                          
                            
                          
                            
                          
                            
                          
                            
                          
                            
                          
                            
                          
                            
                              <li class="navigation-list-item ">
                                <a href="http://localhost:4000/neuron-core/query/list.html" class="navigation-list-link">List</a>
                              </li>
                            
                          
                            
                          
                            
                              <li class="navigation-list-item ">
                                <a href="http://localhost:4000/neuron-core/query/patch.html" class="navigation-list-link">Patch</a>
                              </li>
                            
                          
                            
                          
                            
                              <li class="navigation-list-item ">
                                <a href="http://localhost:4000/neuron-core/query/delete.html" class="navigation-list-link">Delete</a>
                              </li>
                            
                          
                            
                          
                            
                          
                            
                              <li class="navigation-list-item ">
                                <a href="http://localhost:4000/neuron-core/query/filters.html" class="navigation-list-link">Filters</a>
                              </li>
                            
                          
                            
                              <li class="navigation-list-item ">
                                <a href="http://localhost:4000/neuron-core/query/fieldset.html" class="navigation-list-link">Fieldset</a>
                              </li>
                            
                          
                            
                              <li class="navigation-list-item ">
                                <a href="http://localhost:4000/neuron-core/query/selected_fields.html" class="navigation-list-link">Selected Fields</a>
                              </li>
                            
                          
                            
                              <li class="navigation-list-item ">
                                <a href="http://localhost:4000/neuron-core/query/sorts.html" class="navigation-list-link">Sorts</a>
                              </li>
                            
                          
                            
                              <li class="navigation-list-item ">
                                <a href="http://localhost:4000/neuron-core/query/pagination.html" class="navigation-list-link">Pagination</a>
                              </li>
                            
                          
                        </ul>
                      
                    </li>
                  
                
                  
                
                  
                
                  
                
                  
                    <li class="navigation-list-item ">
                      
                      <a href="http://localhost:4000/neuron-core/transactions.html" class="navigation-list-link">Transactions</a>
                      
                    </li>
                  
                
                  
                
                  
                    <li class="navigation-list-item ">
                      
                      <a href="http://localhost:4000/neuron-core/errors/" class="navigation-list-link">Errors</a>
                      
                        
                        <ul class="navigation-list-child-list">
                          
                            
                          
                            
                              <li class="navigation-list-item ">
                                <a href="http://localhost:4000/neuron-core/errors/error_struct.html" class="navigation-list-link">Error Struct</a>
                              </li>
                            
                          
                            
                          
                            
                          
                            
                          
                            
                              <li class="navigation-list-item ">
                                <a href="http://localhost:4000/neuron-core/errors/class.html" class="navigation-list-link">Class</a>
                              </li>
                            
                          
                            
                          
                            
                          
                            
                          
                            
                          
                            
                          
                            
                          
                            
                          
                            
                          
                            
                          
                            
                          
                            
                          
                            
                          
                            
                          
                            
                          
                            
                          
                            
                          
                            
                          
                            
                          
                            
                          
                            
                          
                            
                          
                            
                          
                            
                          
                        </ul>
                      
                    </li>
                  
                
                  
                    <li class="navigation-list-item ">
                      
                      <a href="http://localhost:4000/neuron-core/processor.html" class="navigation-list-link">Processor</a>
                      
                    </li>
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
              </ul>
            
          </li>
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
          <li class="navigation-list-item">
            
            <a href="http://localhost:4000/neuron-gateway/" class="navigation-list-link">Gateway</a>
            
              
              <ul class="navigation-list-child-list ">
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
              </ul>
            
          </li>
        
      
    
      
        
          <li class="navigation-list-item">
            
            <a href="http://localhost:4000/neuron-pq/" class="navigation-list-link">Postgres Repository</a>
            
          </li>
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
          <li class="navigation-list-item">
            
            <a href="http://localhost:4000/neuron-mongo/" class="navigation-list-link">Mongo Repository</a>
            
          </li>
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
  </ul>
</nav>

      </div>
      <footer role="contentinfo" class="site-footer">
        <p class="text-small text-grey-dk-000 mb-0">This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</p>
      </footer>
    </div>
    <div class="main-content-wrap js-main-content" tabindex="0">
      <div class="page-header">
        <div class="main-content">
          
          
            <ul class="list-style-none text-small mt-md-1 mb-md-1 pb-4 pb-md-0 js-aux-nav aux-nav">
              
                <li class="d-inline-block my-0 mr-2"><a href="https://neuronlabs.github.io">Neuron Project</a></li>
              
                <li class="d-inline-block my-0 mr-2"><a href="https://neuronlabs.github.io/neuron-core">Core</a></li>
              
                <li class="d-inline-block my-0 mr-2"><a href="https://neuronlabs.github.io/neuron-gateway">Gateway</a></li>
              
                <li class="d-inline-block my-0 mr-2"><a href="https://neuronlabs.github.io/neuron-pq">PQ Repository</a></li>
              
                <li class="d-inline-block my-0"><a href="https://neuronlabs.github.io/neuron-mongo">Mongo Repository</a></li>
              
            </ul>
          
        </div>
      </div>
      <div class="main-content">
        
          
            <nav class="breadcrumb-nav">
              <ol class="breadcrumb-nav-list">
                
                  <li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/neuron-core">Core ORM</a></li>
                
                <li class="breadcrumb-nav-list-item"><span>Repositories</span></li>
              </ol>
            </nav>
          
        
        <div id="main-content" class="page-content" role="main">
          <h1 id="repositories">Repositories</h1>

<p>Neuron-core use the repositories as the database/data store/service access.
The main abstractions of the repositories are <a href="#factory">repository.Factory</a> and a <a href="#repository">repository.Repository</a>.</p>

<h2 id="factory">Factory</h2>

<p>The Factory is the abstraction used to create new repository instances.
It is also responsible for keeping the instances and closing them.
Each factory have a <strong>unique</strong> driver name, which is used by the repositories  configurations (<code class="highlighter-rouge">*config.Repository</code>) and by the <code class="highlighter-rouge">*controller.Controller</code> which is responsible to get the appropiate factory and create new repository instances for the models. The Factory should be registered within the <code class="highlighter-rouge">neuron-core</code> on package initialization.</p>

<p>Custom factory skeleton may look like in the following example:</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span><span class="x"> </span><span class="n">myfactory</span><span class="x">

</span><span class="k">import</span><span class="x"> </span><span class="p">(</span><span class="x">
    </span><span class="s">"context"</span><span class="x">

    </span><span class="s">"github.com/neuronlabs/neuron-core/mapping"</span><span class="x">
    </span><span class="s">"github.com/neuronlabs/neuron-core/repository"</span><span class="x">
</span><span class="p">)</span><span class="x">

</span><span class="c">// this factory should be registered on the blank import.</span><span class="x">
</span><span class="k">func</span><span class="x"> </span><span class="n">init</span><span class="p">(){</span><span class="x">
    </span><span class="c">// this factory would be registered with the driver name</span><span class="x">
    </span><span class="c">// defined as in the factory 'DriverName' method.</span><span class="x">
    </span><span class="k">if</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">repository</span><span class="o">.</span><span class="n">RegisterFactory</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Factory</span><span class="p">{});</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
        </span><span class="nb">panic</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="x">
    </span><span class="p">}</span><span class="x">
</span><span class="p">}</span><span class="x">

</span><span class="c">// the Factory must implement repository.Factory interface.</span><span class="x">
</span><span class="k">var</span><span class="x"> </span><span class="n">_</span><span class="x"> </span><span class="n">repository</span><span class="o">.</span><span class="n">Factory</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="o">&amp;</span><span class="n">Factory</span><span class="p">{}</span><span class="x">

</span><span class="c">// Factory is the neuron repository.Factory implementation</span><span class="x">
</span><span class="c">// of the custom repository factory.</span><span class="x">
</span><span class="c">// Implements repository.Factory.</span><span class="x">
</span><span class="k">type</span><span class="x"> </span><span class="n">Factory</span><span class="x"> </span><span class="p">{</span><span class="x">
    </span><span class="n">instances</span><span class="x"> </span><span class="p">[]</span><span class="o">*</span><span class="n">Repository</span><span class="x">
    </span><span class="o">...</span><span class="x">
</span><span class="p">}</span><span class="x">

</span><span class="c">// DriverName implements repository.Factory interface.</span><span class="x">
</span><span class="k">func</span><span class="x"> </span><span class="p">(</span><span class="n">f</span><span class="x"> </span><span class="o">*</span><span class="n">Factory</span><span class="p">)</span><span class="x"> </span><span class="n">DriverName</span><span class="p">()</span><span class="x"> </span><span class="kt">string</span><span class="x"> </span><span class="p">{</span><span class="x">
    </span><span class="k">return</span><span class="x"> </span><span class="s">"myfactory"</span><span class="x">
</span><span class="p">}</span><span class="x">

</span><span class="c">// New implements repository.Factory interface.</span><span class="x">
</span><span class="k">func</span><span class="x"> </span><span class="p">(</span><span class="n">f</span><span class="x"> </span><span class="o">*</span><span class="n">Factory</span><span class="p">)</span><span class="x"> </span><span class="n">New</span><span class="p">(</span><span class="n">c</span><span class="x"> </span><span class="n">repository</span><span class="o">.</span><span class="n">Controller</span><span class="p">,</span><span class="x"> </span><span class="n">model</span><span class="x"> </span><span class="o">*</span><span class="n">mapping</span><span class="o">.</span><span class="n">ModelStruct</span><span class="p">)</span><span class="x"> </span><span class="p">(</span><span class="n">repository</span><span class="o">.</span><span class="n">Repository</span><span class="p">,</span><span class="x"> </span><span class="kt">error</span><span class="p">)</span><span class="x"> </span><span class="p">{</span><span class="x">
    </span><span class="c">// Do the logic and create (or use existing) repository instance.</span><span class="x">
</span><span class="p">}</span><span class="x">

</span><span class="c">// Close implements repository.Factory interface.</span><span class="x">
</span><span class="k">func</span><span class="x"> </span><span class="p">(</span><span class="n">f</span><span class="x"> </span><span class="o">*</span><span class="n">Factory</span><span class="p">)</span><span class="x"> </span><span class="n">Close</span><span class="p">(</span><span class="n">ctx</span><span class="x"> </span><span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span><span class="x"> </span><span class="n">done</span><span class="x"> </span><span class="k">chan</span><span class="o">&lt;-</span><span class="k">interface</span><span class="p">{})</span><span class="x"> </span><span class="p">{</span><span class="x">
    </span><span class="k">for</span><span class="x"> </span><span class="n">_</span><span class="p">,</span><span class="x"> </span><span class="n">instance</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="k">range</span><span class="x"> </span><span class="n">f</span><span class="o">.</span><span class="n">instances</span><span class="x"> </span><span class="p">{</span><span class="x">
        </span><span class="k">if</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">instance</span><span class="o">.</span><span class="n">Close</span><span class="p">(</span><span class="n">ctx</span><span class="p">);</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
            </span><span class="c">// handle the error </span><span class="x">
        </span><span class="p">}</span><span class="x">
    </span><span class="p">}</span><span class="x">
    </span><span class="c">// send the information that it finished the closing methods.</span><span class="x">
    </span><span class="n">done</span><span class="x"> </span><span class="o">&lt;-</span><span class="x"> </span><span class="k">struct</span><span class="p">{}</span><span class="x">
</span><span class="p">}</span><span class="x">
</span></code></pre></div></div>

<p>The <code class="highlighter-rouge">repository.Factory</code> is an interface used to create new instances of the <code class="highlighter-rouge">repository.Repository</code>. This interface requires to implement three methods:</p>

<ul>
  <li><code class="highlighter-rouge">DriverName()</code> - which gets the <strong>unique</strong> driver name for the given factory.</li>
  <li><code class="highlighter-rouge">New(c Controller,model *mapping.ModelStruct) (repository.Repository, error)</code>- create new instance of the repository for given ‘model’. The <code class="highlighter-rouge">Controller</code> argument is an interface for the controllers that is used to get model structures. If the Repositories share similar connection configuration it may use the existing instance instead of creating new. The model specific repository configuration are obtainable by using <code class="highlighter-rouge">model.Config().Repository</code></li>
  <li><code class="highlighter-rouge">Close(context.Context, done chan&lt;-interface{})</code> closes all the instances of the factory related repositories.</li>
</ul>

<h2 id="repository">Repository</h2>

<p>The Repository is the abstraction used to get the access to the data/service. 
It may be a used as the ORM access to the database, http.Client to some external service or just a custom accessability by using provided interfaces.
The <code class="highlighter-rouge">repository.Repository</code> is the basic and required interface for the all the repository implementaions. The Repository instances should be created by it’s specific Factory. While registering the models, the controller stores the mapping between repositories and related models. All the Repository methods should not be used by the user directly.</p>

<p>In order to access the data or service the Repository may implement specific interfaces defined in the <code class="highlighter-rouge">query</code> package like:</p>

<ul>
  <li><code class="highlighter-rouge">Creator</code> - creates and stores new instances of the model.</li>
  <li><code class="highlighter-rouge">Getter</code> - gets a single instance of the specific model.</li>
  <li><code class="highlighter-rouge">Lister</code> - lists multiple instances of the given model.</li>
  <li><code class="highlighter-rouge">Patcher</code> - patches only selected model’s value.</li>
  <li><code class="highlighter-rouge">Deleter</code> - deletes the model instances.</li>
  <li><code class="highlighter-rouge">Transactioner</code> - allows to use the transactions.</li>
</ul>

<h3 id="creator">Creator</h3>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span><span class="x"> </span><span class="p">(</span><span class="n">r</span><span class="x"> </span><span class="o">*</span><span class="n">Repository</span><span class="p">)</span><span class="x"> </span><span class="p">(</span><span class="n">ctx</span><span class="x"> </span><span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span><span class="x"> </span><span class="n">scope</span><span class="x"> </span><span class="o">*</span><span class="n">query</span><span class="o">.</span><span class="n">Scope</span><span class="p">)</span><span class="x"> </span><span class="kt">error</span><span class="x"> </span><span class="p">{</span><span class="x">
    </span><span class="c">// Do the create logic here</span><span class="x">
    </span><span class="k">return</span><span class="x"> </span><span class="no">nil</span><span class="x">
</span><span class="p">}</span><span class="x">
</span></code></pre></div></div>

<p>The Create method of the Creator interface requires the Repository to create a specific model instance. For any connection or other relatively long processes the function should check if the ‘<em>ctx</em>’ context is not Done yet. Provided ‘<em>scope</em>’ structure contains multiple important information 
about given query like:</p>

<ul>
  <li><code class="highlighter-rouge">scope.Value</code> - scope.Value contains the model instance in a pointer to struct type.</li>
  <li><code class="highlighter-rouge">SelectedFields()</code> - fields used in the current query.Scope. Only these fields should be stored by this query. It might be useful if a user would like to select and store the zero value fields. If the primary field is not selected, then the Repository should generate new primary field value and set it to the model’s scope.Value instance.</li>
  <li><code class="highlighter-rouge">Struct()</code> - gets <code class="highlighter-rouge">*mapping.ModelStruct</code> for the specific query. The model structure has information about all it’s fields.</li>
</ul>

<p>Any error returned by this method should be an instance of <code class="highlighter-rouge">github.com/neuronlabs/neuron-core/errors</code> <code class="highlighter-rouge">Error</code> or <code class="highlighter-rouge">MultiError</code> with defined error classification (``github.com/neuronlabs/neuron-core/errors/class`).</p>

<h3 id="getter-and-lister">Getter and Lister</h3>

<p><strong>Getter</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span><span class="x"> </span><span class="p">(</span><span class="n">r</span><span class="x"> </span><span class="o">*</span><span class="n">Repository</span><span class="p">)</span><span class="x"> </span><span class="n">Get</span><span class="p">(</span><span class="n">ctx</span><span class="x"> </span><span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span><span class="x"> </span><span class="n">scope</span><span class="x"> </span><span class="o">*</span><span class="n">query</span><span class="o">.</span><span class="n">Scope</span><span class="p">)</span><span class="x"> </span><span class="kt">error</span><span class="x"> </span><span class="p">{</span><span class="x">
    </span><span class="c">// Do the get logic here</span><span class="x">
    </span><span class="k">return</span><span class="x"> </span><span class="no">nil</span><span class="x">
</span><span class="p">}</span><span class="x">
</span></code></pre></div></div>

<p><strong>Lister</strong></p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span><span class="x"> </span><span class="p">(</span><span class="n">r</span><span class="x"> </span><span class="o">*</span><span class="n">Repository</span><span class="p">)</span><span class="x"> </span><span class="n">List</span><span class="p">(</span><span class="n">ctx</span><span class="x"> </span><span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span><span class="x"> </span><span class="n">scope</span><span class="x"> </span><span class="o">*</span><span class="n">query</span><span class="o">.</span><span class="n">Scope</span><span class="p">)</span><span class="x"> </span><span class="kt">error</span><span class="x"> </span><span class="p">{</span><span class="x">
    </span><span class="c">// Do the logic here</span><span class="x">
    </span><span class="k">return</span><span class="x"> </span><span class="no">nil</span><span class="x">
</span><span class="p">}</span><span class="x">
</span></code></pre></div></div>

<p>Both Get method from the Getter and List from the Lister interface should get a specific model instances for provided query ‘<em>scope</em>’. For any connection or other relatively long processes the function should check if the ‘<em>ctx</em>’ context is not Done yet. The get method must not return more than one value instance - (scope.Value is a pointer to the model struct). In order to narrow the scope of the query the <code class="highlighter-rouge">*query.Scope</code> contains multiple important information like:</p>

<ul>
  <li><code class="highlighter-rouge">PrimaryFilters()</code>, <code class="highlighter-rouge">AttributeFilters()</code>, <code class="highlighter-rouge">ForeignKeyFilters()</code>, <code class="highlighter-rouge">FilterKeyFilters()</code> - ‘scope’ methods used to get the specific field’s filters. The Repository should not use the <code class="highlighter-rouge">RelationshipFilters()</code> as the query processor converts them into other filters.</li>
  <li><code class="highlighter-rouge">Fieldset()</code> - fieldset is a set of fields returned for each model for given query.</li>
  <li><code class="highlighter-rouge">Pagination()</code> - a pagination paramters for given query. Get method must always return a single value, even if the pagination is limited to more than one result.</li>
  <li><code class="highlighter-rouge">scope.Value</code> - the value where the results should be stored. It’s instance is already initialized and <strong>must not</strong> be overwritten.</li>
</ul>

<p>Any error returned by this method should be an instance of <code class="highlighter-rouge">github.com/neuronlabs/neuron-core/errors</code> <code class="highlighter-rouge">Error</code> or <code class="highlighter-rouge">MultiError</code> with defined error classification (``github.com/neuronlabs/neuron-core/errors/class`). If there no resultant value was found in related datastore/database then the repository should return an error with <em>no result</em> error classification.</p>

<h3 id="patcher">Patcher</h3>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span><span class="x"> </span><span class="p">(</span><span class="n">r</span><span class="x"> </span><span class="o">*</span><span class="n">Repository</span><span class="p">)</span><span class="x"> </span><span class="n">Patch</span><span class="p">(</span><span class="n">ctx</span><span class="x"> </span><span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span><span class="x"> </span><span class="n">scope</span><span class="x"> </span><span class="o">*</span><span class="n">query</span><span class="o">.</span><span class="n">Scope</span><span class="p">)</span><span class="x"> </span><span class="kt">error</span><span class="x"> </span><span class="p">{</span><span class="x">
    </span><span class="c">// Do the patch logic here</span><span class="x">
    </span><span class="k">return</span><span class="x"> </span><span class="no">nil</span><span class="x">
</span><span class="p">}</span><span class="x">
</span></code></pre></div></div>

<p>The Patch method from the Patcher interface should patch models with the values provided by the ‘<em>scope</em>’.  For any connection or other relatively long processes the function should check if the ‘<em>ctx</em>’ context is not Done yet.
Provided <em>scope</em> contains a single value instance with specific field values, with related filters used to narrow the query. The patch should update <strong>only</strong> the fields defined in the  scope’s <em>selected fields</em>. 
Useful parameters stored in the <em>scope</em>:</p>

<ul>
  <li><code class="highlighter-rouge">scope.Value</code> - the value where the field’s values are stored. It’s instance is already initialized and <strong>must not</strong> replaced with new model’s instance.</li>
  <li><code class="highlighter-rouge">PrimaryFilters()</code>, <code class="highlighter-rouge">AttributeFilters()</code>, <code class="highlighter-rouge">ForeignKeyFilters()</code>, <code class="highlighter-rouge">FilterKeyFilters()</code> - ‘scope’ methods used to get the specific field’s filters. The Repository should not use the <code class="highlighter-rouge">RelationshipFilters()</code> as the query processor converts them into other filters.</li>
  <li><code class="highlighter-rouge">SelectedFields()</code> - fields used in the current query.Scope. Only these fields should be used by this query. It might be useful if a user would like to select and store the zero value fields.</li>
</ul>

<p>Any error returned by this method should be an instance of <code class="highlighter-rouge">github.com/neuronlabs/neuron-core/errors</code> <code class="highlighter-rouge">Error</code> or <code class="highlighter-rouge">MultiError</code> with defined error classification (``github.com/neuronlabs/neuron-core/errors/class`). If there no resultant value was found in related datastore/database then the repository should return an error with <em>no result</em> error classification.</p>

<h3 id="deleter">Deleter</h3>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span><span class="x"> </span><span class="p">(</span><span class="n">r</span><span class="x"> </span><span class="o">*</span><span class="n">Repository</span><span class="p">)</span><span class="x"> </span><span class="n">Delete</span><span class="p">(</span><span class="n">ctx</span><span class="x"> </span><span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span><span class="x"> </span><span class="n">scope</span><span class="x"> </span><span class="o">*</span><span class="n">query</span><span class="o">.</span><span class="n">Scope</span><span class="p">)</span><span class="x"> </span><span class="kt">error</span><span class="x"> </span><span class="p">{</span><span class="err">\</span><span class="x">
    </span><span class="c">// Do the delete logic.</span><span class="x">
    </span><span class="k">return</span><span class="x"> </span><span class="no">nil</span><span class="x">
</span><span class="p">}</span><span class="x">
</span></code></pre></div></div>

<p>The Delete method from the Deleter interface should delete all the matching model instances defined by the given query <em>scope</em>. For any connection or other relatively long processes the function should check if the ‘<em>ctx</em>’ context is not Done yet. The <em>scope</em> should contain all the required filters:</p>

<ul>
  <li><code class="highlighter-rouge">PrimaryFilters()</code>, <code class="highlighter-rouge">AttributeFilters()</code>, <code class="highlighter-rouge">ForeignKeyFilters()</code>, <code class="highlighter-rouge">FilterKeyFilters()</code> - ‘scope’ methods used to get the specific field’s filters. The Repository should not use the <code class="highlighter-rouge">RelationshipFilters()</code> as the query processor converts them into other filters.</li>
</ul>

<p>Any error returned by this method should be an instance of <code class="highlighter-rouge">github.com/neuronlabs/neuron-core/errors</code> <code class="highlighter-rouge">Error</code> or <code class="highlighter-rouge">MultiError</code> with defined error classification (``github.com/neuronlabs/neuron-core/errors/class`). If no values were affected with given query then the repository should return an error with <em>no result</em> error classification.</p>

<h2 id="transactioner">Transactioner</h2>

<p>The Transactioner interface requires the Repository to implement transactions for the specific queries. The transaction’s should be isolated for the specific Repository (the single repository might be used for multiple models with the same database). The <em>scope</em> has a <code class="highlighter-rouge">Tx()</code> method which returns the scope’s transaction structure. This structure contains the Transaction type and it’s unique ID - this value should be used to map the transaction instances.</p>

<p><strong>Begin</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span><span class="x"> </span><span class="p">(</span><span class="n">r</span><span class="x"> </span><span class="o">*</span><span class="n">Repository</span><span class="p">)</span><span class="x"> </span><span class="n">Begin</span><span class="p">(</span><span class="n">ctx</span><span class="x"> </span><span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span><span class="x"> </span><span class="n">scope</span><span class="x"> </span><span class="o">*</span><span class="n">query</span><span class="o">.</span><span class="n">Scope</span><span class="p">)</span><span class="x"> </span><span class="kt">error</span><span class="x"> </span><span class="p">{</span><span class="x">
    </span><span class="c">// Begin the transaction</span><span class="x">
    </span><span class="k">return</span><span class="x"> </span><span class="no">nil</span><span class="x">
</span><span class="p">}</span><span class="x">
</span></code></pre></div></div>
<p>The Begin method should begin the repository specific transaction. In order to follow up the transactions the Repository on <code class="highlighter-rouge">Begin</code> should store related transactions ‘id’ with it’s specific structures - i.e. <em>sql.Tx</em> as well as Begin a transaction on it’s store/database. The transaction should be created with the specific ‘ctx’ context.</p>

<p><strong>Commit</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span><span class="x"> </span><span class="p">(</span><span class="n">r</span><span class="x"> </span><span class="o">*</span><span class="n">Repository</span><span class="p">)</span><span class="x"> </span><span class="n">Commit</span><span class="p">(</span><span class="n">ctx</span><span class="x"> </span><span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span><span class="x"> </span><span class="n">scope</span><span class="x"> </span><span class="o">*</span><span class="n">query</span><span class="o">.</span><span class="n">Scope</span><span class="p">)</span><span class="x"> </span><span class="kt">error</span><span class="x"> </span><span class="p">{</span><span class="x">
    </span><span class="c">// Commit the transaction changes</span><span class="x">
    </span><span class="k">return</span><span class="x"> </span><span class="no">nil</span><span class="x">
</span><span class="p">}</span><span class="x">
</span></code></pre></div></div>
<p>If the query resulted with no error then the transaction should be commited.
The Commit method allows to apply the transaction changes and remove the mapping transaction mapping.</p>

<p><strong>Rollback</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span><span class="x"> </span><span class="p">(</span><span class="n">r</span><span class="x"> </span><span class="o">*</span><span class="n">Repository</span><span class="p">)</span><span class="x"> </span><span class="n">Rollback</span><span class="p">(</span><span class="n">ctx</span><span class="x"> </span><span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span><span class="x"> </span><span class="n">scope</span><span class="x"> </span><span class="o">*</span><span class="n">query</span><span class="o">.</span><span class="n">Scope</span><span class="p">)</span><span class="x"> </span><span class="kt">error</span><span class="x"> </span><span class="p">{</span><span class="x">
    </span><span class="c">// Rollback any changes made by the transation.</span><span class="x">
    </span><span class="k">return</span><span class="x"> </span><span class="no">nil</span><span class="x">
</span><span class="p">}</span><span class="x">
</span></code></pre></div></div>
<p>If the transaction were rolled back then the <code class="highlighter-rouge">Rollback</code> should undo the changes made within given transaction, and remove the transaction mapping.</p>

<p>Any error returned by this method should be an instance of <code class="highlighter-rouge">github.com/neuronlabs/neuron-core/errors</code> <code class="highlighter-rouge">Error</code> or <code class="highlighter-rouge">MultiError</code> with defined error classification (``github.com/neuronlabs/neuron-core/errors/class`).</p>



          
        </div>
      </div>
    </div>
  </div>

</body>
</html>
